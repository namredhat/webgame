<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Neon Shooter (Web)</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
<style>
  html,body{margin:0;padding:0;overflow:hidden;background:#05050f}
  canvas{display:block}


  #signature {
    position: fixed;
    bottom: 10px;
    right: 10px;
    font-family: 'Poppins', sans-serif;
    font-weight: bold;
    font-size: 14px;
    color: rgba(0,255,255,0.5);
    pointer-events: none; /* không chặn click */
    user-select: none;
  }
</style>




</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="fireBtn"></div>
<div id="signature">© 2026 TruongQuocNam--game web</div> 

<script>
let gameOver = false;
let touchStart = null;
// ================== SETUP ==================
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
addEventListener('resize',resize);resize();
const W=()=>canvas.width,H=()=>canvas.height;
const rand=(a,b)=>Math.random()*(b-a)+a;
const dist=(x1,y1,x2,y2)=>Math.hypot(x1-x2,y1-y2);

// ================== COLORS ==================
const C = {
  BLACK:  '#0a0a1f',
  BG_DARK: '#050514',
  WHITE:  '#f0f8ff',
  CYAN:   '#00f8ff',
  CYAN_D: '#00c8dd',
  RED:    '#ff4a7d',
  PURPLE: '#c26aff',
  ORANGE: '#ffaa33',
  GOLD:   '#ffd700',
  GRAY:   '#2a2a4a',
  DARK:   '#121230',
  NEON_GLOW: 'rgba(0, 248, 255, 0.7)',
  NEON_RED:  'rgba(255, 80, 140, 0.8)'
};

// ================== STATE ==================
const player={x:W()/2,y:H()*0.78,tx:W()/2,ty:H()*0.78,hp:5,max:5,tilt:0};
let bullets=[],enemies=[],particles=[],shockwaves=[],trails=[];
let score=0,level=1,nextLevel=1000,shake=0;
let fireCD=0,spawnCD=0,choosing=false;

const upgrades={multishot:0,firerate:0,pierce:0,explode:0,lifesteal:0,homing:0};
const names={multishot:'MULTI-SHOT',firerate:'OVERCLOCK',pierce:'RAILGUN',explode:'SUPERNOVA',lifesteal:'REPAIR',homing:'TRACKER'};

// ================== INPUT ==================
let restartBtn = null;
addEventListener('mousedown', e => {
  if(gameOver && restartBtn){
    if(e.clientX > restartBtn.x && e.clientX < restartBtn.x + restartBtn.w &&
       e.clientY > restartBtn.y && e.clientY < restartBtn.y + restartBtn.h){
      restartGame();
    }
  }
});
addEventListener('touchstart', e => {
  if(gameOver && restartBtn){
    const t = e.touches[0];
    if(t.clientX > restartBtn.x && t.clientX < restartBtn.x + restartBtn.w &&
       t.clientY > restartBtn.y && t.clientY < restartBtn.y + restartBtn.h){
      restartGame();
    }
  }
}, {passive:false});

let mouse={x:W()/2,y:H()/2};
addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY});
addEventListener('mousedown',e=>{if(choosing)selectUpgrade(e.clientX,e.clientY)});
addEventListener('touchmove', e=>{e.preventDefault();mouse.x=e.touches[0].clientX;mouse.y=e.touches[0].clientY},{passive:false});
addEventListener('touchstart', e=>{if(choosing)selectUpgrade(e.touches[0].clientX,e.touches[0].clientY)},{passive:false});
const fireBtn=document.getElementById('fireBtn');let fireActive=false;
fireBtn.addEventListener('touchstart',e=>{fireActive=true;fireBtn.style.transform='scale(0.92)'});
fireBtn.addEventListener('touchend',  e=>{fireActive=false;fireBtn.style.transform='scale(1)'});

// ================== FX ==================
function boom(x,y,c,n=20,s=9,life=1.1){
  for(let i=0;i<n;i++){
    const a = Math.random()*Math.PI*2;
    const v = rand(1.5,s);
    particles.push({
      x,y,
      vx:Math.cos(a)*v, vy:Math.sin(a)*v,
      life, dec:rand(0.025,0.055),
      c, size:rand(1.5,4.5)
    });
  }
}

function glow(x,y,r,c,a=1){
  ctx.save();
  ctx.globalAlpha = a;
  for(let i=4;i>0;i--){
    ctx.globalAlpha *= 0.4;
    ctx.beginPath();
    ctx.arc(x,y,r*i*1.4,0,Math.PI*2);
    ctx.fillStyle = c;
    ctx.fill();
  }
  ctx.restore();
}

function trail(x,y,c='rgba(0,240,255,0.6)'){
  if(Math.random()<0.7) return;
  trails.push({x,y,c,life:0.9,dec:0.08});
}

// ================== UPGRADE ==================
let opts=[],rects=[];
function pickUpgrades(){
 const available=Object.keys(upgrades).filter(k=>upgrades[k]<5);
 opts=available.sort(()=>0.5-Math.random()).slice(0,3);
 rects=opts.map((_,i)=>({x:W()/2-240,y:H()*0.32+i*150,w:480,h:130}));
}
function selectUpgrade(x,y){
 rects.forEach((r,i)=>{if(x>r.x&&x<r.x+r.w&&y>r.y&&y<r.y+r.h){
   upgrades[opts[i]]++;
   choosing=false;
   shake=16;
   boom(W()/2,H()*0.4,C.CYAN,30,12,1.3);
 }})}
function drawUpgrade(){
 ctx.fillStyle='rgba(8,8,30,0.82)';ctx.fillRect(0,0,W(),H());
 ctx.strokeStyle='rgba(0,240,255,0.4)';ctx.lineWidth=2;
 ctx.setLineDash([8,12]); ctx.beginPath(); ctx.rect(0,0,W(),H()); ctx.stroke(); ctx.setLineDash([]);

 rects.forEach((r,i)=>{
  const sel = upgrades[opts[i]] >= 4;
  ctx.fillStyle = sel ? 'rgba(80,40,120,0.4)' : C.DARK;
  ctx.fillRect(r.x,r.y,r.w,r.h,18);
  ctx.strokeStyle = sel ? '#ff88ff' : C.CYAN;
  ctx.lineWidth = sel ? 5 : 3;
  ctx.strokeRect(r.x+4,r.y+4,r.w-8,r.h-8);

  ctx.fillStyle = sel ? '#ffddff' : C.WHITE;
  ctx.font = sel ? 'bold 34px Arial' : 'bold 30px Arial';
  ctx.textAlign = 'left';
  ctx.fillText(`${names[opts[i]]} LV.${upgrades[opts[i]]+1}`,r.x+60,r.y+80);

  ctx.font = '22px Arial';
  ctx.fillStyle = 'rgba(200,220,255,0.8)';
  ctx.fillText(`+${upgrades[opts[i]]+1} ${opts[i].toUpperCase()}`,r.x+60,r.y+115);
 });
 ctx.textAlign = 'center';
}

function restartGame(){
  // reset tất cả
  player.hp = player.max;
  score = 0;
  level = 1;
  nextLevel = 1000;
  bullets = [];
  enemies = [];
  particles = [];
  trails = [];
  shockwaves = [];
  upgrades.multishot = 0;
  upgrades.firerate = 0;
  upgrades.pierce = 0;
  upgrades.explode = 0;
  upgrades.lifesteal = 0;
  upgrades.homing = 0;
  fireCD = 0;
  spawnCD = 0;
  shake = 0;
  choosing = false;
  gameOver = false;
  restartBtn = null;
}

// ================== LOOP ==================
function loop(){
 requestAnimationFrame(loop);

 // background + grid
 ctx.fillStyle=C.BG_DARK; ctx.fillRect(0,0,W(),H());
 ctx.strokeStyle='rgba(0,80,120,0.12)'; ctx.lineWidth=1;
 for(let x=0;x<W();x+=80){
  ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H());ctx.stroke();
 }
 for(let y=0;y<H();y+=80){
  ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W(),y);ctx.stroke();
 }

 let ox = rand(-shake,shake)*0.7, oy = rand(-shake,shake)*0.7;
 shake *= 0.88;

 if(!choosing){
  player.tx=mouse.x;player.ty=mouse.y;
  let dx=player.tx-player.x; player.x+=dx*0.16;
  player.y+=(player.ty-player.y)*0.16;
  player.tilt = Math.max(-28,Math.min(28,dx*0.6));

fireCD--;
if(fireCD <= 0){
   let n=1+upgrades.multishot;
   for(let i=0;i<n;i++){
    let a = (i-(n-1)/2)*0.18;
    let vx = Math.sin(a)*19;
    let vy = -Math.cos(a)*19;
    bullets.push({
      x:player.x+(i-(n-1)/2)*8,
      y:player.y-28,
      vx,vy,
      p:upgrades.pierce,
      h:upgrades.homing,
      life:1.4
    });
    trail(player.x,player.y);
   }
   fireCD = Math.max(4,13-upgrades.firerate*2.1);
  }

  spawnCD--; if(spawnCD<=0){
   let t=['scout','tank','sniper'][Math.floor(Math.random()*3)];
   let e={x:rand(60,W()-60),y:-60,type:t,hp:2+level*0.8|0};
   if(t==='tank')   Object.assign(e,{v:1.1,c:C.PURPLE,r:38,hp:e.hp*4.2});
   else if(t==='scout')Object.assign(e,{v:4.8,c:C.RED,r:20});
   else             Object.assign(e,{v:2.3,c:C.ORANGE,r:27});
   enemies.push(e);
   spawnCD = Math.max(14,85-level*4);
  }
 }

 // ─── SHOCKWAVES ────────────────────────────────────────
 shockwaves.forEach((s,i)=>{
  s.r += 14; s.a -= 12;
  if(s.a<=0) shockwaves.splice(i,1);
  else{
   ctx.strokeStyle=`rgba(255,220,80,${s.a/280})`;
   ctx.lineWidth = 6 - s.a/60;
   ctx.beginPath(); ctx.arc(s.x+ox,s.y+oy,s.r,0,Math.PI*2); ctx.stroke();
   glow(s.x+ox,s.y+oy,s.r*0.7,'rgba(255,240,100,0.4)',s.a/400);
  }
 });

 // ─── BULLETS ───────────────────────────────────────────
 bullets.forEach((b,i)=>{
  if(b.h>0 && enemies.length){
   let t = enemies.reduce((a,e)=>dist(e.x,e.y,b.x,b.y)<dist(a.x,a.y,b.x,b.y)?e:a, enemies[0]);
   let ang = Math.atan2(t.y-b.y, t.x-b.x);
   b.vx += Math.cos(ang)*(0.6 + b.h*0.7);
   b.vy += Math.sin(ang)*(0.6 + b.h*0.7);
   let sp = Math.hypot(b.vx,b.vy);
   if(sp>24){b.vx=b.vx/sp*24; b.vy=b.vy/sp*24}
  }
  b.x+=b.vx; b.y+=b.vy; b.life-=0.014;

  // trail + glow
  trail(b.x,b.y,'rgba(100,240,255,0.7)');
  glow(b.x+ox,b.y+oy,6,C.CYAN,0.5);
  ctx.strokeStyle = `rgba(0,255,255,${b.life*1.4})`;
  ctx.lineWidth = 5 + b.life*2;
  ctx.beginPath();
  ctx.moveTo(b.x+ox,b.y+oy);
  ctx.lineTo(b.x-b.vx*1.6+ox, b.y-b.vy*1.6+oy);
  ctx.stroke();

  if(b.y<-80 || b.x<-80 || b.x>W()+80 || b.life<=0) bullets.splice(i,1);
 });

 // ─── ENEMIES ───────────────────────────────────────────
 enemies.forEach((e,ei)=>{
  e.y += e.v; let ex=e.x+ox, ey=e.y+oy;



  ctx.strokeStyle = e.c; ctx.lineWidth=4;
  ctx.shadowColor = e.c; ctx.shadowBlur=25;

  ctx.beginPath();
  if(e.type==='tank'){
   for(let i=0;i<7;i++){let a=i*Math.PI/3.5+Date.now()*0.001;ctx.lineTo(ex+Math.cos(a)*e.r,ey+Math.sin(a)*e.r)}
   ctx.closePath();
  }else if(e.type==='scout'){
   ctx.moveTo(ex,ey+e.r*1.1);
   ctx.lineTo(ex-e.r*0.9,ey-e.r*0.7);
   ctx.lineTo(ex+e.r*0.9,ey-e.r*0.7);
   ctx.closePath();
  }else{
   ctx.moveTo(ex,ey-e.r);
   ctx.lineTo(ex+e.r*0.9,ey);
   ctx.lineTo(ex,ey+e.r*1.1);
   ctx.lineTo(ex-e.r*0.9,ey);
   ctx.closePath();
  }
  ctx.stroke(); ctx.shadowBlur=0;

  bullets.forEach((b,bi)=>{
   if(dist(e.x,e.y,b.x,b.y)<e.r+6){
    e.hp--;
    boom(b.x,b.y,C.WHITE,8,4,0.9);
    if(b.p>0) b.p--; else bullets.splice(bi,1);
    if(e.hp<=0){
     score+=100; shake=15;
     boom(e.x,e.y,e.c,28,10,1.4);
     if(upgrades.explode>0){
      shockwaves.push({x:e.x,y:e.y,r:20,a:240});
      enemies.forEach(o=>{if(dist(o.x,o.y,e.x,e.y)<180)o.hp-=upgrades.explode*3.5})
     }
     if(upgrades.lifesteal>0 && Math.random()<0.18) player.hp = Math.min(player.max,player.hp+1);
     enemies.splice(ei,1);
    }
   }
  });

  if(dist(e.x,e.y,player.x,player.y)<e.r+28){
   player.hp--; shake=30; enemies.splice(ei,1);
   boom(player.x,player.y,C.RED,18,6);
  }
 });

 // ─── PLAYER ────────────────────────────────────────────
 let px=player.x+ox, py=player.y+oy;

 // engine glow + particles

 for(let i=0;i<3;i++){
  let s = rand(8,24);
  ctx.fillStyle = `rgba(255,${180-i*40},40,${0.6+i*0.15})`;
  ctx.beginPath();
  ctx.ellipse(px+rand(-6,6)+player.tilt*0.25, py+rand(8,18), 5, s, 0,0,Math.PI*2);
  ctx.fill();
 }

 // ship body
 ctx.shadowColor=C.CYAN; ctx.shadowBlur=20;
 ctx.beginPath();
 ctx.moveTo(px, py-42);
 ctx.lineTo(px-32+player.tilt, py+18);
 ctx.lineTo(px-12+player.tilt*0.4, py+4);
 ctx.lineTo(px+12+player.tilt*0.4, py+4);
 ctx.lineTo(px+32+player.tilt, py+18);
 ctx.closePath();
 ctx.fillStyle = C.WHITE; ctx.fill();
 ctx.strokeStyle = C.CYAN; ctx.lineWidth=5; ctx.stroke();
 ctx.shadowBlur=0;


 // ─── PARTICLES & TRAILS ────────────────────────────────
 trails.forEach((t,i)=>{
  t.life -= t.dec;
  if(t.life<=0) trails.splice(i,1);
  else{
   ctx.globalAlpha = t.life*1.3;
   ctx.fillStyle = t.c;
   ctx.fillRect(t.x-1,t.y-1,2,2);
  }
 });
 ctx.globalAlpha=1;

 particles.forEach((p,i)=>{
  p.x+=p.vx; p.y+=p.vy; p.life-=p.dec;
  if(p.life<=0) particles.splice(i,1);
  else{
   ctx.globalAlpha = p.life*1.6;
   ctx.fillStyle = p.c;
   ctx.beginPath();
   ctx.arc(p.x+ox,p.y+oy, p.size*p.life*1.8,0,Math.PI*2);
   ctx.fill();
  }
 });
 ctx.globalAlpha=1;

// --- HUD & LEVEL (NEW HP BAR) ---
const isMobile = W() < 600;
const baseScale = isMobile ? W() / 420 : W() / 1200;
const fontSize = Math.max(16, 22 * baseScale);

// Cấu hình thanh HP
const hpBarWidth = isMobile ? W() * 0.75 : 320 * baseScale;
const hpBarHeight = isMobile ? 16 : 20 * baseScale;
const hudX = (W() - hpBarWidth) / 2;
const hudY = isMobile ? 50 : 35;

// Màu sắc mới cho HP
const HP_COLORS = {
    high: '#ff3264',   // Đỏ Neon
    low: '#ff9600',    // Cam khi máu thấp
    bg: 'rgba(255, 0, 0, 0.15)' // Nền đỏ mờ
};

ctx.save();

// 1. Glow nhẹ phía sau thanh máu
ctx.shadowBlur = 15;
ctx.shadowColor = HP_COLORS.high;

// 2. Nền thanh HP
ctx.fillStyle = 'rgba(20, 0, 0, 0.6)';
if (ctx.roundRect) {
    ctx.beginPath();
    ctx.roundRect(hudX, hudY, hpBarWidth, hpBarHeight, 10);
    ctx.fill();
} else {
    ctx.fillRect(hudX, hudY, hpBarWidth, hpBarHeight);
}

// 3. Gradient cho phần HP hiện tại
let hpGradient = ctx.createLinearGradient(hudX, 0, hudX + hpBarWidth, 0);
hpGradient.addColorStop(0, '#800020');  // Đỏ rượu
hpGradient.addColorStop(0.5, HP_COLORS.high);
hpGradient.addColorStop(1, '#ff6b81');  // Đỏ hồng nhạt

// 4. Vẽ máu hiện tại
const hpRatio = Math.max(0, player.hp / player.max);
ctx.fillStyle = hpRatio < 0.3 ? HP_COLORS.low : hpGradient;
ctx.shadowBlur = hpRatio < 0.3 ? 20 : 10;  // máu thấp glow mạnh hơn
if (ctx.roundRect) {
    ctx.beginPath();
    ctx.roundRect(hudX, hudY, hpBarWidth * hpRatio, hpBarHeight, 10);
    ctx.fill();
} else {
    ctx.fillRect(hudX, hudY, hpBarWidth * hpRatio, hpBarHeight);
}



// 6. Level & Score
ctx.fillStyle = C.WHITE;
ctx.font = `bold ${fontSize}px Arial`;
ctx.textAlign = 'center';
ctx.shadowBlur = 5;
ctx.shadowColor = 'black';
ctx.fillText(`LV ${level}   •   SCORE ${score}`, W() / 2, hudY - 12);

ctx.restore();



if(player.hp<=0){
  gameOver = true;
  
  ctx.fillStyle='rgba(200,20,60,0.9)';
  ctx.font='bold 80px Arial';
  ctx.textAlign='center';
  ctx.fillText('SYSTEM FAILURE',W()/2,H()/2-20);
  const btnW = 250, btnH = 60;
  const btnX = W()/2 - btnW/2, btnY = H()/2 + 50;
  ctx.fillStyle = 'rgba(0,200,255,0.8)';
  ctx.fillRect(btnX, btnY, btnW, btnH, 12);
  ctx.strokeStyle = C.CYAN;
  ctx.lineWidth = 4;
  ctx.strokeRect(btnX, btnY, btnW, btnH);
  ctx.fillStyle = C.WHITE;
  ctx.font = 'bold 30px Arial';
  ctx.fillText('RESTART', W()/2, btnY + 40);

  restartBtn = {x:btnX, y:btnY, w:btnW, h:btnH};
}


 if(choosing) drawUpgrade();
}
requestAnimationFrame(loop);
</script>
</body>
</html>
